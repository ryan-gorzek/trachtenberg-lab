---
title: "R Notebook"
output: html_notebook
---

```{r}

library(ggplot2)
library(dplyr)

# Create dataframes
opossum.data <- data.frame(
  sample = paste0("Opossum_", 1:3),
  species = "Opossum",
  # OD = c(121, 158, 31),
  OD = c(80, 74, 27), 
  PV = c(72, 74, 26),
  # NeuN = c(1063, 942, 580), 
  NeuN = c(2034, 1904, 1263),
  x = c(2000, 2000, 1170),
  y = c(1500, 1550, 1350)
)

mouse.data <- data.frame(
  sample = paste0("Mouse_", 1:4),
  species = "Mouse",
  # OD = c(174, 63, 76, 98),
  OD = c(137, 39, 46, 79), 
  PV = c(39, 8, 10, 27),
  # NeuN = c(1031, 491, 523, 770), 
  NeuN = c(3551, 1580, 1910, 2098),
  x = c(2450, 1200, 1400, 1450),
  y = c(1550, 1400, 1250, 1400)
)

# Combine
all.data <- bind_rows(opossum.data, mouse.data)

# Compute area (in µm²) and densities
all.data <- all.data %>%
  mutate(
    area_mm2 = ((0.25 * x * y) / 1e6) * 0.9,
    OD_density = OD / area_mm2, 
    PV_density = PV / area_mm2, 
    NeuN_density = NeuN / area_mm2
  )

# Reshape to long format for ggplot
density.long <- all.data %>%
  select(sample, species, OD_density, PV_density, NeuN_density) %>%
  tidyr::pivot_longer(cols = c(OD_density, PV_density, NeuN_density),
                      names_to = "cell.identity",
                      values_to = "density") %>%
  mutate(cell.identity = recode(cell.identity, OD_density = "OD", PV_density = "PV", NeuN_density = "NeuN"))

density.long.pv <- density.long[density.long$cell.identity == "PV", ]
density.long.od <- density.long[density.long$cell.identity == "OD", ]
density.long.neun <- density.long[density.long$cell.identity == "NeuN", ]

# Plot PV
ggplot(density.long.pv, aes(x = factor(cell.identity, levels = c("PV")), y = density, fill = species)) +
  geom_bar(stat = "summary", fun = "median", position = position_dodge(width = 0.8), width = 0.75) +
  geom_point(position = position_dodge(width = 0.8), size = 1, colour = "black") +
  scale_y_continuous(expand = c(0, 0)) +
  scale_x_discrete(labels = c("PV")) +
  scale_fill_manual(values = c("Opossum" = "#c692b8", "Mouse" = "#aaaaaa")) +
  theme_classic() +
  theme(axis.text = element_text(color = "black"),
        legend.text = element_text(size = 10)) +
  labs(x = NULL, y = "Density (cells / µm²)", fill = NULL)

# Plot OD
ggplot(density.long.od, aes(x = factor(cell.identity, levels = c("OD")), y = density, fill = species)) +
  geom_bar(stat = "summary", fun = "median", position = position_dodge(width = 0.8), width = 0.75) +
  geom_point(position = position_dodge(width = 0.8), size = 1, colour = "black") +
  scale_y_continuous(expand = c(0, 0)) +
  scale_x_discrete(labels = c("OD")) +
  scale_fill_manual(values = c("Opossum" = "#c692b8", "Mouse" = "#aaaaaa")) +
  theme_classic() +
  theme(axis.text = element_text(color = "black"),
        legend.text = element_text(size = 10)) +
  labs(x = NULL, y = "Density (cells / µm²)", fill = NULL)

# Plot NeuN
ggplot(density.long.neun, aes(x = factor(cell.identity, levels = c("NeuN")), y = density, fill = species)) +
  geom_bar(stat = "summary", fun = "median", position = position_dodge(width = 0.8), width = 0.75) +
  geom_point(position = position_dodge(width = 0.8), size = 1, colour = "black") +
  scale_y_continuous(expand = c(0, 0)) +
  scale_x_discrete(labels = c("NeuN")) +
  scale_fill_manual(values = c("Opossum" = "#c692b8", "Mouse" = "#aaaaaa")) +
  theme_classic() +
  theme(axis.text = element_text(color = "black"),
        legend.text = element_text(size = 10)) +
  labs(x = NULL, y = "Density (cells / mm²)", fill = NULL)

```

